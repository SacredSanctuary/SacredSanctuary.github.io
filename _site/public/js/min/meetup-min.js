!function(){var e={};e.meetup={},e.meetup.endpoint="https://api.meetup.com/",e.meetup.key="65557b272b2e302051116d2e4c5468d",e.meetup.group="ilovepracticalspirituality",e.meetup.events=[],e.meetup.rsvps=[],e.meetup.rsvpIDs=[],e.meetup.initialize=function(){e.meetup.checkLogin()},e.getUrlVars=function(){for(var e=[],t,s=window.location.hash.substring(1).split("&"),n=0;n<s.length;n++)t=s[n].split("="),e.push(t[0]),e[t[0]]=t[1];return e},e.meetup.checkLogin=function(){e.queryString=e.getUrlVars(),e.queryString.access_token?e.meetup.getUser(e.queryString.access_token):($("#rsvp button").on("click",function(t){t.preventDefault(),e.meetup.login()}),e.meetup.getEvents())},e.meetup.login=function(){var e="https://secure.meetup.com/oauth2/authorize";e+="?client_id=ggd1jrdcj14fpaj9tpahc5gnpb",e+="&response_type=token",e+="&redirect_uri=http://localhost:4000/calendar.html",window.location=e},e.meetup.getUser=function(t){var s=e.meetup.endpoint+"2/members";s+="?member_id=self",s+="&photo-host=public",s+="&access_token="+t,$.ajax({method:"get",dataType:"jsonp",url:s,success:function(s){try{e.meetup.getRsvps(t,s.results[0].name)}catch(n){console.log(n),window.location="//"+window.location.host+window.location.pathname}},error:function(e){console.log(e)}})},e.meetup.getRsvps=function(t,s){$(".rsvps h3 span").html(s+"â€™s <br/> RSVPs"),$("#rsvp").html("<div></div>");var n=e.meetup.endpoint+"self/events";n+="?scroll=next_upcoming",n+="&photo-host=public",n+="&access_token="+t,$.ajax({method:"get",dataType:"jsonp",url:n,success:function(t){console.log(t.data);for(var s in t.data){var n=t.data[s];if(n.group.urlname===e.meetup.group){e.meetup.rsvpIDs.push(n.id);var o={title:n.name,id:n.id,start:n.time+n.utc_offset,end:n.time+n.duration+n.utc_offset,url:n.event_url,fee:n.fee};e.meetup.rsvps.push(o)}}for(var a=1;a<=e.meetup.rsvps.length;a++){var r=e.meetup.rsvps[a-1];$("#rsvp").append("<div></div>"),$("#rsvp div:nth-of-type( "+a+" )").loadTemplate($("#rsvpTemplate"),{classTitle:r.title,classId:r.id,classDescription:r.description,classLink:r.url,classDate:moment(r.start).format("MMMM Do YYYY, h:mm a")+" - "+moment(r.end).format("h:mm a"),classFee:r.fee?r.fee.label+": $"+r.fee.amount:[]})}e.meetup.getEvents(),console.log(e.meetup.rsvpIDs),console.log(JSON.stringify(e.meetup.rsvps[0]))},error:function(e){console.log(e)}})},e.meetup.getEvents=function(){var t=e.meetup.endpoint+"2/events?sign=true";t+="&group_urlname="+e.meetup.group,t+="&key="+e.meetup.key,$.ajax({method:"get",dataType:"jsonp",url:t,success:function(t){e.meetup.events=t.results;var s=[];for(var n in e.meetup.events){var o=e.meetup.events[n],a=$.inArray(o.id,e.meetup.rsvpIDs)>=0?"going":"not",r={title:o.name,id:o.id,start:o.time+o.utc_offset,end:o.time+o.duration+o.utc_offset,url:o.event_url,description:o.description,className:["classes",a],rsvp:{yes:o.yes_rsvp_count,max:o.rsvp_limit,you:$.inArray(o.id,e.meetup.rsvpIDs)>=0?"Attending":"RSVP"},fee:o.fee};s.push(r)}$("#calendar").fullCalendar({header:{left:"title",center:"",right:"month,agendaWeek today prev,next"},editable:!1,eventClick:function(e,t){return t.preventDefault(),$("#classModal .modal-content").loadTemplate($("#classTemplate"),{classTitle:e.title,classDescription:e.description,classLink:e.url,classFee:e.fee?e.fee.label+": $"+e.fee.amount:[],classRSVP:e.rsvp.yes?e.rsvp.yes:0,classRSVPMax:e.rsvp.max?" / "+e.rsvp.max:"",classRSVPyou:e.rsvp.you,classDate:e.start.format("MMMM Do YYYY<br> h:mm a")+(e.end?" - "+e.end.format("h:mm a"):"")}),$("#classModal").modal("show"),!1},events:s})},error:function(e){console.log(e)}})},$(window).load(function(){e.meetup.initialize()})}();